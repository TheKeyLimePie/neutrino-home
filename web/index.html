<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>Neutrino server</title>
		<style>
			@font-face
			{
				font-family: bin;
				src: url("binregular.otf") format("opentype");
			}
			html, body, canvas
			{
				width: 100%;
				height: 100%;
				margin: 0;
				padding: 0;
				display: block;
			}
		</style>
	</head>
	<body>
		<canvas id="cv" width="400" height="300"></canvas>
		<script>
			showingmessage = false;
			readspeed = 600;
			defaultphrase = "NEUTRINO";
			phrase = defaultphrase;
			hue = Math.random() * 360;
			sat = Math.random() * 100 + 1;
			val = Math.random() * 100 + 1;
			
			function changePhrase(txt)
			{
				phrase = txt;
			}
			
			function showText(string, i = -1)
			{
				words = string.split(" ");
				if(words.length == 0)
				{
				}
				else if(i == -1)
				{
					showingmessage = true;
					changePhrase("");
					window.setTimeout(function(){showText(string, i + 1)}, readspeed);
				}
				else if(i < words.length)
				{
					changePhrase(words[i]);
					window.setTimeout(function(){showText(string, i + 1)}, readspeed);
				}
				else if(i == words.length)
				{
					changePhrase("");
					window.setTimeout(function(){showingmessage = false; changePhrase(defaultphrase);}, readspeed);
				}
			}
			
			function draw()
			{
				/*
					c: canvas handle
					radius: neutrino's radius
				*/
				function drawClock(c, radius)
				{
					var ctx = c.getContext("2d");
					var innerRadius = radius - 1 / 8 * radius;
					midX = c.width / 2;
					midY = c.height / 2;
					ctx.lineWidth = 2;
					var second = (new Date()).getSeconds() == 0 ? 60 : (new Date()).getSeconds();

					for(var i = 0; i < second; i++)
					{
						var rad = (i + 1) / 60 * 2 * Math.PI;
						var markerLength = 0;
						ctx.strokeStyle = val < 50 ? "rgba(255,255,255,0.25)" : "rgba(0,0,0,0.25)";
						if((i + 1) % 5 == 0)
						{
							ctx.strokeStyle = val < 50 ? "rgba(255,255,255,0.65)" : "rgba(0,0,0,0.65)";
							markerLength += 1 / 24 * radius;
						}
						if((i + 1) % 15 == 0)
						{
							ctx.strokeStyle = val < 50 ? "#fff" : "#000";
							markerLength += 1 / 16 * radius;
						}
						ctx.beginPath();
						ctx.moveTo(midX - Math.sin(-rad) * (innerRadius - markerLength), midY - Math.cos(-rad) * (innerRadius - markerLength));
						ctx.lineTo(midX - Math.sin(-rad) * radius, midY - Math.cos(-rad) * radius);
						ctx.stroke();
					}
				}
				/*
					c: canvas handle
					radius: neutrino's radius
				*/
				function drawNeutrino(c, radius)
				{
					var t = (new Date()).getTime() % (1000 * 1);
					t /= 1000 * 1;
					var ctx = c.getContext("2d");
					ctx.beginPath();
					ctx.arc(c.width / 2, c.height / 2, radius, 0, 2 * Math.PI);
					ctx.fillStyle = "hsl(" + hue + "," + sat + "%," + val + "%)";
					ctx.fill();
					
					if(showingmessage)
					{
						ctx.strokeStyle = val < 50 ? "#fff" : "#000";
						ctx.lineWidth = 3;
						ctx.beginPath();
						var startangle = t * 2 * Math.PI;
						ctx.arc(c.width / 2, c.height / 2, radius - 1 / 4 * radius, startangle, startangle + Math.PI / 6);
						ctx.stroke();
					}
					
					ctx.font = 1 / 4 * radius + "px bin, sans-serif";
					ctx.fillStyle = val < 50 ? "#fff" : "#000";
					ctx.textAlign = "center";
					ctx.textBaseline = "middle";
					ctx.fillText(phrase, c.width / 2, c.height / 2);
				}
				/*
					c: canvas handle
					radius: neutrino's radius
					maxRadius: max radius covered by pulse
					duration: pulse duration in seconds
					pow: pow factor for pulse animation
				*/
				function drawPulse(c, radius, maxRadius, duration, pow)
				{
					var ctx = c.getContext("2d");
					var t = (new Date()).getTime() % (1000 * duration);
					t /= 1000 * duration; // linear in [0,1)
					var pulseFactor = Math.log(1 + t * Math.pow(Math.E, pow)) / Math.log(1 + Math.pow(Math.E, pow)); // logarithmic in [0,1)
					var width = maxRadius - radius;
					
					ctx.beginPath();
					ctx.arc(c.width / 2, c.height / 2, radius + pulseFactor * width, 0, 2 * Math.PI);
					//ctx.fillStyle = "hsla(" + hue + "," + sat + "%," + val + "%," + Math.cos(Math.PI / 4 + t * Math.PI / 4) + ")";
					ctx.fillStyle = "hsla(" + hue + "," + sat + "%," + val + "%," + (1 - pulseFactor) + ")";
					ctx.fill();
				}
				
				var c = document.getElementById("cv");
				var ctx = c.getContext("2d");
				c.width = window.innerWidth;
				c.height = window.innerHeight;
				ctx.fillStyle = val < 50 ? "#fff" : "#000";
				ctx.fillRect(0,0,cv.width, cv.height);
				
				var radius = window.innerHeight < window.innerWidth ? window.innerHeight : window.innerWidth;
				radius /= 3;
				radius /= 2;
				var pulseRadius = Math.sqrt(Math.pow(window.innerHeight, 2) + Math.pow(window.innerWidth, 2));
				pulseRadius /= 2;
				drawPulse(c, radius, pulseRadius, 5, 4);
				drawNeutrino(c, radius);
				drawClock(c, radius);
				
				requestAnimationFrame(draw);
			}
			draw();
		</script>
	</body>
</html>